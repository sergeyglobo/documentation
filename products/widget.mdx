---
title: "Widget Integration"
description: "Передовое платежное решение для приема депозитов с криптозеркалированием"
icon: "dumpster-fire"
tag: "BETA"
---

import TestCards from '/snippets/test-cards.mdx';

## Общая схема работы

```mermaid
sequenceDiagram
    autonumber
    actor Клиент
    participant Проект
    participant Finmar API
    Клиент->>Проект: Выбор платежного виджета
    Проект->>Finmar API: Передача данных для создания операции
    Finmar API-->>Проект: Возврат URL виджета
    Проект->>Клиент: Перенаправление на URL виджета
    Клиент->>Finmar API: Покупка криптовалюты<br>и подтверждение оферты
    Finmar API->>Проект: Уведомление<br>о завершении операции
    Проект->>Проект: Обработка уведомления
    Проект->>Finmar API: Подтверждение обработки операции
```

<Steps>
  <Step title="Выбор платежного виджета">
    Клиент выбирает иконку платежного виджета в интерфейсе сайта проекта
  </Step>
  <Step title="Передача данных для создания операции">
    Сайт проекта отправляет в Finmar API реквизиты операции: данные клиента, сумму и валюту в фиате

    <Accordion title="Пример запроса создания" icon="terminal">
      ```bash Запрос создания операции
      curl --location 'https://sandbox.finmar.tech/prepare2/api/v3/checkout' \
      --header 'Content-Type: application/json' \
      --header 'Authorization: Basic cHJldmlld190ZXN0OndkMzAxN2F6aW01aXNva3E=' \
      --data-raw '{
      "client_operation_id": "DSPn7pryR4QYBQpCGq",
      "report_metadata": "DSPn7pryR4QYBQpCGq",
      "payment_profile": "sandbox",
      "method": "widget_integration",
      "project_id":"s002",
      "amount": {
          "amount": "100",
          "currency": "EUR"
      },
      "user": {
          "user_id": "u123",
          "email": "globocheck@gmail.com",
          "statistics": {
              "registered_at": "2021-11-02",
              "total_deposit_count": 485,
              "total_withdrawal_count": 693
          }
      },
      "url_callback": "https://finmar.requestcatcher.com/?callback",
      "url_redirect_success": "https://finmar.requestcatcher.com?success",
      "url_redirect_fail": "https://finmar.requestcatcher.com?fail"
      }'
      ```
    </Accordion>
  </Step>
  <Step title="Получение URL виджета">
    Finmar API создает уникальный URL виджета и возвращает его сайту проекта

    <Accordion title="Пример ответа" icon="server">
      ```json
      {
      "success": true,
      "result": {
          "url": "https://card.cheipho.com/transaction/a32f658c-df98-4fc2-8bad-cbcf49aa8ee3",
          "reference_id": "a32f658c-df98-4fc2-8bad-cbcf49aa8ee3"
      },
      "trace_id": "22c0f041f9b149f8b24ca9ce7df501fa"
      }
      ```
    </Accordion>
  </Step>
  <Step title="Перенаправление клиента">
    Сайт проекта автоматически перенаправляет клиента на сгенерированный платежный URL
  </Step>
  <Step title="Проведение операции">
    Клиент совершает покупку криптовалюты и подтверждает условия оферты в интерфейсе Виджета.

    При отладке на sandbox окружении используйте тестовые карты:

    <TestCards />
  </Step>
  <Step title="Уведомление о завершении операции">
    Finmar API отправляет сайту проекта уведомление о завершении транзакции. Пример:

    <Accordion title="Пример уведомления" icon="sparkles">
      ```json
      {
          "card": {
            "charged": {
              "amount": 12,
              "currency": "EUR"
            },
            "initial": {
              "amount": 12,
              "currency": "EUR"
            },
            "oper_type": "deposit",
            "requested": {
              "amount": 12,
              "currency": "EUR"
            },
            "payment_method": "185_catalyst_preauth",
            "requested_changed": false,
            "initial_chyment_anged": false,
            "is_3d_secure_attempted": true
          },
          "meta": {
            "user": {
              "kyc": {
                "result": "SUCCESS",
                "verification_kind": "ID_DOCUMENT",
                "sumsub_share_token": "_act-jwt-fake-token-eybhdgcijoibl2fldc2mjpib25lih0-eyjqdgiioijnwf-hjy1otc0otqtntg1ns00nmqslwkzodytlwlwy2rlnjeyzgm4mcisinjsiioiahr0cHM6ly9hccm2n3vtywjllmzyzwuihw."
              },
              "email": "johndoe@example.com",
              "login": "johndoe@example.com",
              "user_id": "8c5f49e0-3e28-4f81-8b2b-0f04c7a52e1f",
              "statistics": {
                "registered_at": "2024-05-15T10:30:00.000Z",
                "total_deposit_count": 28,
                "most_recent_deposit_at": "2025-08-01 15:45:30",
                "total_withdrawal_count": 5,
                "registration_ip_address": "192.168.1.1",
                "most_recent_withdrawal_at": "2025-07-10 09:12:05"
              },
              "email_verified": true
            },
            "amount": {
              "amount": "12.00",
              "currency": "EUR"
            },
            "locale": "US",
            "comment": {
              "guid": "5678901",
              "action": "deposit_v3",
              "variant": "open_banking"
            },
            "project_id": "fake_project",
            "url_callback": "https://api.fake-pay.services/pg/callback/a1b2c3d4-e5f6-7890-1234-567890abcdef/deposit",
            "payment_profile": "test_integration_fake",
            "url_redirect_fail": "https://api.fake-pay.services/redirect/result/a1b2c3d4-e5f6-7890-1234-567890abcdef/deposit/5678901/failure",
            "client_operation_id": "5678901",
            "operation_display_id": "5678901",
            "url_redirect_success": "https://api.fake-pay.services/redirect/result/a1b2c3d4-e5f6-7890-1234-567890abcdef/deposit/5678901/success"
          },
          "rates": {
            "ETH-AUD": 5958.39372449629,
            "ETH-CAD": 5335.9483560368,
            "ETH-EUR": 3327.71605539468,
            "ETH-USD": 3886.46995424805,
            "EUR-AUD": 1.7905354980143,
            "EUR-CAD": 1.60348667590989,
            "EUR-USD": 1.167909127327
          },
          "crypto": [
            {
              "amount": 13.337059,
              "status": "success",
              "currency": "ETH__USDC__137",
              "to_address": "0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b",
              "crypto_txn_id": "0x1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c",
              "parent_fiat_amount": 12,
              "parent_fiat_currency": "EUR"
            },
            {
              "status": "success",
              "to_address": null,
              "crypto_txn_id": "0xd1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2"
            }
          ],
          "result": "complete",
          "deposit": {
            "amount": 12,
            "currency": "EUR"
          },
          "user_id": "8c5f49e0-3e28-4f81-8b2b-0f04c7a52e1f",
          "reference_id": "f9e8d7c6-b5a4-3210-fedc-ba9876543210",
          "current_status": "success",
                    "payment_product": "widget_integration",
                    "client_operation_id": "4129259",
                    "payment_custom_data": null,
                    "payment_method_type": "fiat"
      }
      ```

      asd
    </Accordion>
  </Step>
  <Step title="Обработка уведомления">
    Сайт проекта обрабатывает полученное уведомление и зачисляет полученную сумму на счёт пользователя.
  </Step>
  <Step title="Подтверждение обработки">
    Сайт проекта вызывает метод Finmar API для подтверждения обработки операции.
  </Step>
</Steps>