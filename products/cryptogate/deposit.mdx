---
title: "–ö—Ä–∏–ø—Ç–æ–≥–µ–π—Ç. –ü—Ä–∏—ë–º –ø–ª–∞—Ç–µ–∂–µ–π"
icon: "link"
description: "–ü—Ä–∏—ë–º –ø–ª–∞—Ç–µ–∂–µ–π –≤ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞—Ö"
---

## –û–±—â–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

<Steps>
  <Step title="–ü—Ä–æ–µ–∫—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ç–µ–π –∏ –∞—Å—Å–µ—Ç–æ–≤">
    –ü—Ä–æ–µ–∫—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ç–µ–π –∏ –∞—Å—Å–µ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—è –º–µ—Ç–æ–¥ [/api/v3/gate/get-address/currencies/](https://vima.mintlify.app/api-reference/%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D1%8B%D1%85-%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B2%D0%B0%D0%BB%D1%8E%D1%82-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B0%D0%B4%D1%80%D0%B5%D1%81%D0%B0?playground=open) –∏–ª–∏ [/api/v3/gate/get-url/currencies/](https://vima.mintlify.app/api-reference/%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C-%D1%81%D0%BF%D0%B8%D1%81%D0%BE%D0%BA-%D0%B4%D0%BE%D1%81%D1%82%D1%83%D0%BF%D0%BD%D1%8B%D1%85-%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B2%D0%B0%D0%BB%D1%8E%D1%82-%D0%B4%D0%BB%D1%8F-%D0%B3%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D0%B8-url?playground=open).

    –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

    ```bash get-address/currencies
    curl --request GET \
    --url https://sandbox.finmar.tech/prepare2/api/v3/gate/get-address/currencies/sandbox \
    --header 'Authorization: Basic cHJldmlld190ZXN0OndkMzAxN2F6aW01aXNva3E='
    ```

    ```bash get-url/currencies
    curl --request GET \
    --url https://sandbox.finmar.tech/prepare2/api/v3/gate/get-url/currencies/sandbox \
    --header 'Authorization: Basic cHJldmlld190ZXN0OndkMzAxN2F6aW01aXNva3E='
    ```

    –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

    ```json get-address/currencies
    {
      "success": true,
      "result": [
        {
          "crypto_network": "TRX",
          "crypto_assets": [
            "TRX",
            "USDT"
          ]
        },
        {
          "crypto_network": "MATIC",
          "crypto_assets": [
            "MATIC",
            "USDC"
          ]
        }
      ],
      "trace_id": "99395c4231744dbd934a6342ecca878a"
    }
    ```

    ```json get-url/currencies
    {
    "success": true,
    "result": [
    {
      "crypto_network": "TRX",
      "crypto_assets": [
        "TRX",
        "USDT"
      ]
    },
    {
      "crypto_network": "MATIC",
      "crypto_assets": [
        "MATIC",
        "USDC"
      ]
    }
    ],
    "trace_id": "9cc9e282a6d641f1add088fce54051de"
    }
    ```
  </Step>
  <Step title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –∫—Ä–∏–ø—Ç–æ–∞–∫—Ç–∏–≤–æ–≤ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å">
    
  </Step>
  <Step title="–°–µ—Ä–≤–∏—Å –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç">
    –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ —á–∏—Å–ª–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π —Å–µ—Ç–∏, —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ –∑–∞—Ä–∞–Ω–µ–µ —É–∫–∞–∑–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π `url_callback` –∫–æ–ª–±–µ–∫, –æ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—Ä–∏–ø—Ç–æ–∞–∫—Ç–∏–≤–æ–≤

    –ü—Ä–∏–º–µ—Ä—ã –∫–æ–ª–±–µ–∫–æ–≤:

    <RequestExample>

    ```json TRX
    {
             "crypto": [
               {
                 "amount": 1.11,
                 "currency": "TRX",
                 "status": "success",
                 "to_address": "TFQsv4umwyrBwgzM6adZdpTHvpYZrZLUYG"
               }
             ],
             "deposit": 
             {
                // –ü–æ–ª—É—á–µ–Ω–Ω–∞—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—É–º–º–∞. –ï—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—á–∏—Å–ª–∏—Ç—å –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
               "amount": 1.11,
               "currency": "TRX"
             },
             "result": "complete",
            
             // —Ç–∏–ø –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞
             "payment_method_type": "crypto_deposit",
           
             // –ø–ª–∞—Ç—ë–∂–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
             "payment_product": "cryptogate",
          
             // –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä—ã. –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–µ–±—É–µ–º—ã–µ, —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å —á–∞—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. 
             "rates": 
             {
               "TRX-AUD": 0.25037386021435254,
               "TRX-CAD": 0.22943992050960907,
               "TRX-EUR": 0.15417145982562155,
               "TRX-USD": 0.164771894913
             },
               // –≥–ª–æ–±–∞–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–æ–º. –°–ª–µ–¥—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –µ–≥–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.
             "reference_id": "b5ba93ba-7eae-42f1-8955-5d13eec2f6cf",
             
              // —Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏. success - —É—Å–ø–µ—à–Ω–∞. 
              "current_status": "success",
             
             // –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
             "user_id": "d4177559-2a1d-40e3-a4f2-6e32e607b8b1"
           }
    ```

    
    ```json USDC
    {
      "deposit": { 
        "amount": 2, 
        "currency": "USDC"
      },
      "crypto": [
        {
          "amount": 2,
          "status": "success",
          "currency": "USDC",
          "oper_type": "deposit",
          "to_address": "0xb971b4a175d8c2dc2b9a454da834244320e1d4cc",
          "crypto_txn_id": "0xc6443ee59d106020f1a162f2d262e012d9a19baea2a8f154e3c472765a9d0a9f"
        }
      ],
    // –∫—É—Ä—Å—ã –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä—ã. –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–µ–±—É–µ–º—ã–µ, —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å —á–∞—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. 
      "rates": {
        "USDC-EUR": 0.879283902353817,
        "USDC-RUB": 82.2496786216588,
        "USDC-USD": 1.012387556321
      },
      "result": "complete",
      "user_id": "21",//–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
      "reference_id": "d0d8c391-5bea-4c9f-962f-f131f1ae9d4c", // –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–∏—Å–∞. –ü—Ä–æ–µ–∫—Ç—É —Å–ª–µ–¥—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ
      "current_status": "success",
      "payment_product": "cryptogate_direct",
      "payment_method_type": "crypto_deposit",
      "payment_custom_data": null
    }
    ```

    </RequestExample>
  </Step>
  <Step title="–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–ø–µ—Ä–∞—Ü–∏–∏">
    –ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—É–º–º—ã –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  </Step>
  <Step title="–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏">
    –ü–æ —Ñ–∞–∫—Ç—É —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∑–∞—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è), –ø—Ä–æ–µ–∫—Ç –≤—ã–∑—ã–≤–∞–µ—Ç [–º–µ—Ç–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏](/api-reference/endpoint/client_confirm_payment_by_reference_id) –∏—Å–ø–æ–ª—å–∑—É—è `reference_id` –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –≤ –∫–æ–ª–±–µ–∫–µ.
  </Step>
</Steps>

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–µ—Ç–∏ –∏ –º–æ–Ω–µ—Ç—ã

| **Crypto Network** | **Crypto Assets** |
| :----------------- | :---------------- |
| TRX                | TRX, USDT         |
| MATIC              | MATIC, USDC, USDT |
| ETH                | ETH, USDC, USDT   |
| SOL                | SOL, USDC, USDT   |
| TON                | TON, USDT         |
| BNB                | BNB, USDC, USDT   |
| BTC                | BTC               |

<Warning>
  –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Å—É–º–º—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å–ª–µ–¥—É–µ—Ç —É—Ç–æ—á–Ω–∏—Ç—å –≤ —á–∞—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
</Warning>

## –û–±—Ä–∞—Ç–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–î–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å —Ç–µ–ª HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Å—Å–∏–º–µ—Ç—Ä–∏—á–Ω–æ–π –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏. –ü–æ–¥–ø–∏—Å—å –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–≤—É—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ (RSA-SHA256), –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ø–∏—Å—å –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏—Å—Ö–æ–¥—è –∏–∑ —Å–≤–æ–∏—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π. –ö–∞–∂–¥–æ–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∫–ª—é—á–µ–π –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö HTTP —Å–æ–æ–±—â–µ–Ω–∏—è.

<Info>
  üîê**rsa_key_id**

  ```
  rsa_5a0a491aa67d4adcbbf4f056a6916c52
  ```

  üîè**rsa_public_key_pem**

  ```
  -----BEGIN PUBLIC KEY-----
  MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA06A9dAL8C54nJbzb8BOl
  MtDl+osccv+5Ayqst5jSgbRMaBMDfTewzxq90SY8hcQnjvPWEvtLrojQ2827XRxv
  jKDxiiWWHVeB7zgZKAVh7p6E1fC84+WRZoaAqSErRreDbAss1w5Ouj77IFWTlvU3
  uSq0KpjHAkJz01KSiQvfn2GQfMzzHdQHJR+0Sp6/GLtpWsJkAviiyL5M6TkUxv9W
  aIDN1/8MFAbn04iDWGtvx7ngrF8rqsjChQznZ7MPRDbloNS5Lslp5qXY5G/lbliO
  EmZYjcRc6Bth/opSpqFcf1cuwCgfgPgVHlXn7h3ilSWG94idniKLD8iudpQhe9X5
  wCjmMrLYSz3I0oMWycyexcxRPb8RzaqYFmIBN5kyUsGi1CVvXAC93rBGMNpZHxCf
  voD07tkXRRREqdKrpASUUnFpyGQhuYxWYNFNDM9VJj7A3V81+zSxUMQ3Yh7ASo2x
  pBWHlnkAPZm9WXjx+kZLr7XsYdeXN5X+MFZsTAn5WWmWOTs6IjCbOvR/TaEh2cUq
  4dIDE/43JYSfBqilM8FTCFkcKRyHEmSxELEstUGcTIAk8bNiW9QIzIH9F+kI0+Cx
  AgnioYHmBn7cFXUrXbG8lnh8FQ9IarwGtm5NSZxEgNtdgw0NesEse6VrFwCa78nL
  OqKXbZ77tjdr9C/UeKTLzrcCAwEAAQ==
  -----END PUBLIC KEY-----
  ```
</Info>

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ RSA-SHA256

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ RSA –ø–æ–¥–ø–∏—Å–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö HTTP —Å–æ–æ–±—â–µ–Ω–∏—è:

`X-RSA-KEY-ID` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ RSA –∫–ª—é—á–∞ `X-RSA-NONCE` - —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ nonce, —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ `X-RSA-SHA256-SIGN` - –ø–æ–¥–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ base64

–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∏: –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π RSA –∫–ª—é—á –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-RSA-KEY-ID` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-RSA-NONCE` —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è `body` - –±–∏–Ω–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–ª–∞ HTTP —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8 - —Ç–æ —á—Ç–æ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ —Å–µ—Ç–∏, –ø–æ—Å–ª–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å—å `sign` –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è `nonce+body` —Å –ø–æ–º–æ—â—å—é RSA —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è SHA256 –∏ —Ñ–æ—Ä–º–∞—Ç–æ–º –ø–æ–¥–ø–∏—Å–∏ PKCS#1 v1.5 –ø–æ–ª—É—á–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å `sign` –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ base64 –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-RSA-SHA256-SIGN`

–ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏: –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-RSA-KEY-ID` –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø—É–±–ª–∏—á–Ω—ã–π RSA –∫–ª—é—á –±–µ—Ä–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ nonce –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-RSA-NONCE` –±–µ—Ä–µ—Ç—Å—è `body` - –±–∏–Ω–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–ª–∞ HTTP —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8 - —Ç–æ —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–æ –ø–æ —Å–µ—Ç–∏, –¥–æ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–µ `X-RSA-SHA256-SIGN` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –∏–∑ base64 –≤ –±–∏–Ω–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `sign` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ `sign` –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è `nonce+body` —Å –ø–æ–º–æ—â—å—é RSA —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è SHA256 –∏ —Ñ–æ—Ä–º–∞—Ç–æ–º –ø–æ–¥–ø–∏—Å–∏ PKCS#1 v1.5 —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –µ—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ

<Expandable title="–ü—Ä–∏–º–µ—Ä –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ PHP">
  ```php
  <?php
  /*
      Callback arrives with following HTTP headers:
          x-rsa-nonce	- contains nonce value
          x-rsa-key-id - contains rsa public key id
          x-rsa-sha256-sign - contains rsa-sha256 signature of request body
          x-ecdsa-key-id - contains ecdsa public key id
          x-ecdsa-sha256-sign - contains ecdsa-sha256 signature of request body
  
      Callback signatures check:
          - get body of the request as utf-8
          - get rsa public key by x-rsa-key-id
          - get ecdsa public key by x-ecdsa-key-id
          - calculate rsa-sha256 signature of the body
          - compare calculated rsa-sha256 signature with x-rsa-sha256-sign
          - calculate ecdsa-sha256 signature of the body
          - compare calculated ecdsa-sha256 signature with x-ecdsa-sha256-sign
      
      Common callback JSON format:
          {
              "reference_id": "2fe9bb11-6033-4d9e-94d0-ad829a993e6e",
              "user_id": "1Go2gaAQ",
              "created_at": "0001-01-01T00:00:00",
              "result": "fail|complete",
              "deposit": { 
                  "amount": 10.0, 
                  "currency": "EUR" 
              }
              .. metadata fields ...
          }
      
      In case of "complete" callback  confirmation must be sent to provider as 
      POST to {BASE_URL}/client_confirm_success_payment_by_reference_id:
          {
              "reference_id": "id from callback body"
          }
  */
  
  // finmar base URL
  $finmar_base_url = ' https://sandbox.finmar.tech/collector/api/v3';
  
  // used for Basic HTTP auth in request
  $finmar_login = 'XXXXXXXX';
  $finmar_password = 'XXXXXXXXXX';
  $finmar_auth_key = base64_encode($finmar_login . ':' . $finmar_password);
  
  // allowed IP addresses
  $ip_white_list = array('134.122.55.160', '141.95.16.27', '163.172.116.59');
  $use_whitelist = false;
  
  // known RSA public keys
  $rsa_public_keys = array(
      "rsa_5a0a491aa67d4adcbbf4f056a6916c52" =>
      "-----BEGIN PUBLIC KEY-----\nMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA06A9dAL8C54nJbzb8BOl\nMtDl+osccv+5Ayqst5jSgbRMaBMDfTewzxq90SY8hcQnjvPWEvtLrojQ2827XRxv\njKDxiiWWHVeB7zgZKAVh7p6E1fC84+WRZoaAqSErRreDbAss1w5Ouj77IFWTlvU3\nuSq0KpjHAkJz01KSiQvfn2GQfMzzHdQHJR+0Sp6/GLtpWsJkAviiyL5M6TkUxv9W\naIDN1/8MFAbn04iDWGtvx7ngrF8rqsjChQznZ7MPRDbloNS5Lslp5qXY5G/lbliO\nEmZYjcRc6Bth/opSpqFcf1cuwCgfgPgVHlXn7h3ilSWG94idniKLD8iudpQhe9X5\nwCjmMrLYSz3I0oMWycyexcxRPb8RzaqYFmIBN5kyUsGi1CVvXAC93rBGMNpZHxCf\nvoD07tkXRRREqdKrpASUUnFpyGQhuYxWYNFNDM9VJj7A3V81+zSxUMQ3Yh7ASo2x\npBWHlnkAPZm9WXjx+kZLr7XsYdeXN5X+MFZsTAn5WWmWOTs6IjCbOvR/TaEh2cUq\n4dIDE/43JYSfBqilM8FTCFkcKRyHEmSxELEstUGcTIAk8bNiW9QIzIH9F+kI0+Cx\nAgnioYHmBn7cFXUrXbG8lnh8FQ9IarwGtm5NSZxEgNtdgw0NesEse6VrFwCa78nL\nOqKXbZ77tjdr9C/UeKTLzrcCAwEAAQ==\n-----END PUBLIC KEY-----\n"
  );
  
  // known ECDSA public keys
  $ecdsa_public_keys = array(
      "ecdsa_0367cda2b64f4db3b29f9faac7fe6419" =>
      "-----BEGIN PUBLIC KEY-----\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEBZXR4hpDPlG/jIBjeUKNpnyAIMVY\nUFc7X5/BHdnW3TmXyQht1DG05DmdCtwROD0orI1jGRQmP7PDWV2MB1xuRQ==\n-----END PUBLIC KEY-----\n"
  );
  
  // check callback source IP address
  function check_client_ip()
  {
      global $ip_white_list;
      global $use_whitelist;
      if (!$use_whitelist) {
          return;
      }
      if (!in_array($_SERVER['REMOTE_ADDR'], $ip_white_list)) {
          http_response_code(403);
          die('IP not allowed');
      }
  }
  
  // get POST body
  function get_post_body()
  {
      // check request method
      if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
          http_response_code(405);
          die('Method Not Allowed');
      }
      $body = file_get_contents('php://input');
      if ($body === false) {
          http_response_code(400);
          die('Bad request');
      }
      return $body;
  }
  
  // get RSA data from headers
  function get_rsa_data()
  {
      global $rsa_public_keys;
  
      // check key ID
      $key_id = @$_SERVER['HTTP_X_RSA_KEY_ID'];
      if ($key_id === null) {
          http_response_code(400);
          die('X-RSA-KEY-ID not set');
      }
      if (!array_key_exists($key_id, $rsa_public_keys)) {
          http_response_code(400);
          die('RSA key not found by X-RSA-KEY-ID');
      }
  
      // check nonce
      $rsa_nonce = @$_SERVER['HTTP_X_RSA_NONCE'];
      if ($rsa_nonce === null) {
          http_response_code(400);
          die('X-RSA-NONCE not set');
      }
  
      // check signature
      $rsa_signature = @$_SERVER['HTTP_X_RSA_SHA256_SIGN'];
      if ($rsa_signature === null) {
          http_response_code(400);
          die('X-RSA-SHA256-SIGN not set');
      }
      // return all data as associative array
      return array(
          'key_id' => $key_id,
          'nonce' => $rsa_nonce,
          'signature' => $rsa_signature,
          'public_key' => $rsa_public_keys[$key_id]
      );
  }
  
  // get ECDSA data from headers
  function get_ecdsa_data()
  {
      global $ecdsa_public_keys;
  
      // check key ID
      $key_id = @$_SERVER['HTTP_X_ECDSA_KEY_ID'];
      if ($key_id === null) {
          http_response_code(400);
          die('X-ECDSA-KEY-ID not set');
      }
      if (!array_key_exists($key_id, $ecdsa_public_keys)) {
          http_response_code(400);
          die('ECDSA key not found by X-ECDSA-KEY-ID');
      }
  
      // check signature
      $ecdsa_signature = @$_SERVER['HTTP_X_ECDSA_SHA256_SIGN'];
      if ($ecdsa_signature === null) {
          http_response_code(400);
          die('X-ECDSA-SHA256-SIGN not set');
      }
      // return all data as associative array
      return array(
          'key_id' => $key_id,
          'signature' => $ecdsa_signature,
          'public_key' => $ecdsa_public_keys[$key_id]
      );
  }
  
  // check RSA by provided data
  function check_rsa_sign($body, $rsa)
  {
      // Combine nonce and body
      $data = $rsa['nonce'] . $body;
  
      // Decode base64 signature
      $signature = base64_decode($rsa['signature']);
      if ($signature === false) {
          return false;
      }
  
      // Create public key resource
      $pubkey = openssl_pkey_get_public($rsa['public_key']);
      if ($pubkey === false) {
          return false;
      }
  
      // Verify signature
      $result = openssl_verify(
          $data,
          $signature,
          $pubkey,
          OPENSSL_ALGO_SHA256
      );
  
      // Return true if signature is valid (result === 1)
      return $result === 1;
  }
  
  // check ECDSA by provided data
  function check_ecdsa_sign($body, $ecdsa)
  {
      // Decode base64 signature
      $signature = base64_decode($ecdsa['signature']);
      if ($signature === false) {
          return false;
      }
  
      // Create public key resource
      $pubkey = openssl_pkey_get_public($ecdsa['public_key']);
      if ($pubkey === false) {
          return false;
      }
  
      // Verify signature
      $result = openssl_verify(
          $body,
          $signature,
          $pubkey,
          OPENSSL_ALGO_SHA256
      );
  
      // Return true if signature is valid (result === 1)
      return $result === 1;
  }
  
  // get reference ID from JSON body
  function get_reference_id($body)
  {
      $data = json_decode($body, true);
      return $data['reference_id'];
  }
  
  // get callback result from JSON body
  function get_callback_result($body)
  {
      $data = json_decode($body, true);
      return $data['result'];
  }
  
  // send confirmation request to provider
  function confirm_operation($body)
  {
      global $finmar_base_url, $finmar_auth_key;
      // get reference ID
      $reference_id = get_reference_id($body);
      if ($reference_id === null) {
          http_response_code(400);
          die('Confirmation failed - reference ID not found in body');
      }
      $url = $finmar_base_url . '/client_confirm_success_payment_by_reference_id';
      // encode data
      $data = json_encode(array('reference_id' => $reference_id));
      // make post with curl
      $ch = curl_init($url);
      curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');
      curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
      curl_setopt($ch, CURLOPT_HTTPHEADER, array(
          'Content-Type: application/json',
          'Content-Length: ' . strlen($data),
          'Authorization: Basic ' . $finmar_auth_key
      ));
      curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
      $response = curl_exec($ch);
      $status = curl_getinfo($ch, CURLINFO_HTTP_CODE);
      curl_close($ch);
      // check response status
      if ($status !== 200) {
          http_response_code(400);
          die('Confirmation failed - ' . $response);
      }
  }
  
  // send text/plain response
  header('Content-Type: application/json');
  // check client IP
  check_client_ip();
  
  // required data
  $body = get_post_body();
  $rsa = get_rsa_data();
  $ecdsa = get_ecdsa_data();
  
  // check RSA signature
  if (!check_rsa_sign($body, $rsa)) {
      http_response_code(400);
      die('RSA signature check failed');
  }
  
  // check ECDSA signature
  if (!check_ecdsa_sign($body, $ecdsa)) {
      http_response_code(400);
      die('ECDSA signature check failed');
  }
  
  // check if callback is complete
  if (get_callback_result($body) === 'complete') {
      confirm_operation($body);
  }
  
  // return empty response on success
  http_response_code(200);
  echo "{}";
  ```
</Expandable>

### –ü–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–¥–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç–ª–∏—á–Ω–æ–≥–æ –æ—Ç 200 –∏–ª–∏ 204 –±—É–¥–µ—Ç –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç–æ 10 –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º.

<Info>
  –ï—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–∏—Å –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–ª–±–µ–∫ –≤–µ—Ä–Ω—É–ª –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ 200 –∏–ª–∏ 204, —Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–º
</Info>

## –í–∑–∞–∏–º–æ—Ä–∞—Å—á—ë—Ç—ã

soon